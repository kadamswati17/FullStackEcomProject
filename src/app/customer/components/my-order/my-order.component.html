<h2 class="table-heading">My Orders</h2>

<div class="table-container">
  <mat-table class="mat-elevation-z8" [dataSource]="myOrders">
    <ng-container matColumnDef="id">
      <mat-header-cell *matHeaderCellDef>Order ID</mat-header-cell>
      <mat-cell *matCellDef="let myOrder">
        <a href="#" (click)="getOrderDetailsByIdts(myOrder.id)" data-bs-toggle="modal"
          data-bs-target="#orderDetailsModal">
          {{ myOrder.id }}
        </a>
      </mat-cell>
    </ng-container>

    <ng-container matColumnDef="userName">
      <mat-header-cell *matHeaderCellDef>User</mat-header-cell>
      <mat-cell *matCellDef="let myOrder">{{ myOrder.userName }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="trackingId">
      <mat-header-cell *matHeaderCellDef>Tracking ID</mat-header-cell>
      <mat-cell *matCellDef="let myOrder">{{ myOrder.trackingId }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="amount">
      <mat-header-cell *matHeaderCellDef>Amount</mat-header-cell>
      <mat-cell *matCellDef="let myOrder">{{ myOrder.amount }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="orderDescription">
      <mat-header-cell *matHeaderCellDef>Description</mat-header-cell>
      <mat-cell *matCellDef="let myOrder">{{ myOrder.orderDescription }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="address">
      <mat-header-cell *matHeaderCellDef>Address</mat-header-cell>
      <mat-cell *matCellDef="let myOrder">{{ myOrder.address }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="date">
      <mat-header-cell *matHeaderCellDef>Date</mat-header-cell>
      <mat-cell *matCellDef="let myOrder">{{ myOrder.date | date: 'dd/MM/yyyy' }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="orderStatus">
      <mat-header-cell *matHeaderCellDef>Status</mat-header-cell>
      <mat-cell *matCellDef="let myOrder">{{ myOrder.orderStatus }}</mat-cell>
    </ng-container>

    <ng-container matColumnDef="action">
      <mat-header-cell *matHeaderCellDef>Action</mat-header-cell>
      <mat-cell *matCellDef="let myOrder">
        <button mat-raised-button color="primary" (click)="openReviewDialog(myOrder)"
          [disabled]="myOrder.orderStatus?.trim().toLowerCase() !== 'delivered'">
          Review
        </button>
      </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns" class="custom-header-row"></mat-header-row>
    <mat-row *matRowDef="let row; columns: displayedColumns" class="custom-row"></mat-row>

  </mat-table>
</div>

<!-- ================= ORDER DETAILS MODAL ================= -->
<div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="orderDetailsModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="orderDetailsModalLabel">Order Details</h5>
        <button class="btn btn-sm btn-success" (click)="downloadInvoicePDF()">Download PDF</button>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body" id="invoice-content">


        <div *ngIf="cartItems.length > 0" class="mb-4 cart-info-container">
          <div class="row">
            <div class="col-12 col-md-4 mb-2"><strong>Order ID:</strong> {{ cartItems[0].orderId }}</div>
            <div class="col-12 col-md-4 mb-2"><strong>Order Date:</strong> {{ cartItems[0].orderDate | date:'dd/MM/yyyy'
              }}</div>
            <div class="col-12 col-md-4 mb-2"><strong>Status:</strong> {{ cartItems[0].orderStatus }}</div>
          </div>

          <div class="row">
            <div class="col-12 col-md-4 mb-2"><strong>User ID:</strong> {{ cartItems[0].userId }}</div>
            <div class="col-12 col-md-4 mb-2"><strong>Email:</strong> {{ cartItems[0].email }}</div>
            <div class="col-12 col-md-4 mb-2"><strong>Total :</strong> ₹{{ cartItems[0].totalAmount }}</div>
          </div>
        </div>


        <div *ngIf="cartItems.length === 0" class="text-center text-muted">
          No order details found.
        </div>

        <div class="table-responsive" *ngIf="cartItems.length > 0">
          <table class="table table-bordered table-hover">
            <thead class="table-dark">
              <tr>
                <th>#</th>
                <th>Image</th>
                <th>Product</th>
                <th>Price</th>
                <th>Qty</th>
                <th>Amount</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of cartItems; let i = index">
                <td>{{ i + 1 }}</td>
                <td>
                  <img *ngIf="item.productImg" [src]="'data:image/jpeg;base64,' + item.productImg" alt="Product Image"
                    class="product-img" />
                </td>
                <td>{{ item.productName }}</td>
                <td>₹{{ item.productPrice }}</td>
                <td>{{ item.quantity }}</td>
                <td>₹{{ item.productPrice * item.quantity }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div> <!-- /modal-body -->
    </div>
  </div>
</div>